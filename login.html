<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>เข้าสู่ระบบ - TaxOnline</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>
<body class="bg-gradient-to-r from-pink-200 via-blue-200 to-purple-200 min-h-screen flex justify-center items-center">
  <div class="max-w-md w-full bg-white p-8 rounded-2xl shadow-lg">
    <h2 class="text-2xl font-bold text-center text-pink-600 mb-6">เข้าสู่ระบบ / สมัครสมาชิก</h2>
    <div class="flex justify-center space-x-4 mb-6">
      <button id="loginTab" class="px-4 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700">เข้าสู่ระบบ</button>
      <button id="signupTab" class="px-4 py-2 bg-green-600 text-white rounded-full hover:bg-green-700">สมัครสมาชิก</button>
    </div>

    <form id="loginForm" class="space-y-4 hidden">
      <input type="email" id="loginEmail" placeholder="อีเมล" class="w-full p-3 border rounded-lg">
      <input type="password" id="loginPassword" placeholder="รหัสผ่าน" class="w-full p-3 border rounded-lg">
      <button class="w-full bg-blue-600 text-white py-2 rounded-lg font-semibold hover:bg-blue-700">เข้าสู่ระบบ</button>
    </form>

    <form id="signupForm" class="space-y-4 hidden">
      <input type="text" id="signupFirstName" placeholder="ชื่อ" class="w-full p-3 border rounded-lg">
      <input type="text" id="signupLastName" placeholder="นามสกุล" class="w-full p-3 border rounded-lg">
      <input type="email" id="signupEmail" placeholder="อีเมล" class="w-full p-3 border rounded-lg">
      <input type="password" id="signupPassword" placeholder="รหัสผ่าน" class="w-full p-3 border rounded-lg">
      <button class="w-full bg-green-600 text-white py-2 rounded-lg font-semibold hover:bg-green-700">สมัครสมาชิก</button>
    </form>

    <p id="authMessage" class="text-red-500 text-center mt-4 text-sm"></p>
  </div>

  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyBl-j4STHVQ80VNM6mPl80-55BHk4nEyZk",
      authDomain: "tax-online-6afdd.firebaseapp.com",
      projectId: "tax-online-6afdd",
      storageBucket: "tax-online-6afdd.appspot.com",
      messagingSenderId: "959276043439",
      appId: "1:959276043439:web:f358ce055687efea5d185a"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    const loginForm = document.getElementById("loginForm");
    const signupForm = document.getElementById("signupForm");
    const authMessage = document.getElementById("authMessage");

    document.getElementById("loginTab").addEventListener("click", ()=>{
      loginForm.classList.remove("hidden"); signupForm.classList.add("hidden"); authMessage.textContent="";
    });
    document.getElementById("signupTab").addEventListener("click", ()=>{
      signupForm.classList.remove("hidden"); loginForm.classList.add("hidden"); authMessage.textContent="";
    });

    signupForm.addEventListener("submit", e=>{
      e.preventDefault();
      const firstName = document.getElementById("signupFirstName").value.trim();
      const lastName = document.getElementById("signupLastName").value.trim();
      const email = document.getElementById("signupEmail").value.trim();
      const password = document.getElementById("signupPassword").value;
      if(!firstName||!lastName||!email||!password){authMessage.textContent="กรุณากรอกข้อมูลให้ครบทุกช่อง";return;}
      auth.createUserWithEmailAndPassword(email,password)
        .then(uc=>{
          const user=uc.user;
          return user.updateProfile({displayName:firstName+" "+lastName}).then(()=>db.collection("users").doc(user.uid).set({
            uid:user.uid,firstName,lastName,email,createdAt:firebase.firestore.FieldValue.serverTimestamp()
          }));
        })
        .then(()=>window.location.href="index.html")
        .catch(err=>authMessage.textContent=err.message);
    });

    loginForm.addEventListener("submit", e=>{
      e.preventDefault();
      const email=document.getElementById("loginEmail").value;
      const password=document.getElementById("loginPassword").value;
      auth.signInWithEmailAndPassword(email,password)
        .then(()=>window.location.href="index.html")
        .catch(err=>authMessage.textContent=err.message);
    });

    document.getElementById("loginTab").click();
  </script>
</body>
</html>
