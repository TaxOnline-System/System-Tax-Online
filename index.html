<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TaxOnline - Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background: linear-gradient(-45deg, #e0c3fc, #8ec5fc, #fbc2eb, #a1c4fd);
      background-size: 400% 400%;
      animation: gradientAnimation 15s ease infinite;
    }
    @keyframes gradientAnimation {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    /* Splash */
    #splash {
      position: fixed; top:0; left:0; width:100%; height:100%;
      display:flex; flex-direction:column; justify-content:center; align-items:center;
      background:white; z-index:9999; transition:opacity 1s;
    }
    .splash-spinner {
      width:60px; height:60px; border:8px solid transparent; border-top-color:#ec4899; border-radius:50%;
      animation: spin 2s linear infinite;
    }
    @keyframes spin {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
  </style>
</head>
<body class="font-sans">
  <!-- Splash Screen -->
  <div id="splash">
    <div class="splash-spinner"></div>
    <h2 class="text-xl text-pink-600 mt-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏∞‡∏ö‡∏ö...</h2>
  </div>

  <!-- Top bar: Date/Time + Dark Mode -->
  <div class="fixed top-4 left-4 z-50 bg-white dark:bg-gray-800 text-sm px-3 py-1 rounded shadow">
    <span id="datetime">--:--</span>
  </div>
  <div class="fixed top-4 right-4 z-50">
    <button onclick="toggleDarkMode()" class="bg-white dark:bg-gray-700 text-gray-700 dark:text-white px-4 py-2 rounded shadow text-sm font-medium">
      üåô Toggle Dark Mode
    </button>
  </div>

  <!-- Header -->
  <header class="bg-white dark:bg-gray-900 shadow p-4">
    <div class="max-w-6xl mx-auto flex justify-between items-center">
      <h1 class="text-2xl font-bold text-pink-600 dark:text-yellow-300">TaxOnline</h1>
      <nav class="space-x-3">
        <a href="index.html" class="text-pink-600 dark:text-yellow-400 hover:underline">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
        <a href="history.html" class="text-gray-600 dark:text-gray-200 hover:underline">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</a>
        <a href="profile.html" class="text-gray-600 dark:text-gray-200 hover:underline">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</a>
        <a href="login.html" class="text-blue-600 dark:text-yellow-400 hover:underline font-semibold">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a>
      </nav>
    </div>
  </header>

  <!-- Section: Calculator -->
  <section class="px-4 py-12">
    <div class="max-w-md mx-auto bg-white dark:bg-gray-900 p-6 rounded-2xl shadow-xl">
      <h3 class="text-xl font-semibold text-center text-blue-600 dark:text-purple-300 mb-4">‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏†‡∏≤‡∏©‡∏µ</h3>
      <form class="space-y-4" id="taxForm">
        <div>
          <label class="block text-gray-800 dark:text-gray-200">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏ö‡∏≤‡∏ó)</label>
          <input type="number" id="income" class="w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white">
        </div>
        <div>
          <label class="block text-gray-800 dark:text-gray-200">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏ö‡∏≤‡∏ó)</label>
          <input type="number" id="expense" class="w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white">
        </div>
        <div>
          <label class="block text-gray-800 dark:text-gray-200">‡∏Ñ‡πà‡∏≤‡∏•‡∏î‡∏´‡∏¢‡πà‡∏≠‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
          <input type="number" id="deduction" value="60000" class="w-full p-2 border rounded-lg dark:bg-gray-800 dark:text-white">
        </div>
        <div>
          <label class="block text-gray-800 dark:text-gray-200">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à</label>
          <input type="file" id="receiptUpload" accept="image/*,.pdf" multiple class="w-full mt-1">
          <div id="fileInfo" class="text-sm mt-1"></div>
          <div id="previewArea" class="mt-2 grid grid-cols-3 gap-2"></div>
        </div>
        <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-lg font-bold hover:bg-blue-700 transition">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏†‡∏≤‡∏©‡∏µ</button>
      </form>
      <div class="mt-6"><canvas id="taxPieChart"></canvas></div>
    </div>
  </section>

  <footer class="bg-white dark:bg-gray-900 p-4 text-center text-sm text-gray-500 dark:text-gray-400">
    &copy; 2025 ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏†‡∏≤‡∏©‡∏µ ‡∏û‡πà‡∏≠‡∏Ñ‡πâ‡∏≤ ‡πÅ‡∏°‡πà‡∏Ñ‡πâ‡∏≤‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå
  </footer>

  <script>
    // Dark Mode
    function toggleDarkMode() {
      document.documentElement.classList.toggle("dark");
      localStorage.setItem("theme", document.documentElement.classList.contains("dark")?"dark":"light");
    }
    if(localStorage.getItem("theme")==="dark") document.documentElement.classList.add("dark");

    // Date/Time
    function updateDateTime(){
      const now = new Date();
      const options={weekday:'long',year:'numeric',month:'long',day:'numeric'};
      const timeStr=now.toLocaleTimeString('th-TH');
      const dateStr=now.toLocaleDateString('th-TH',options);
      document.getElementById('datetime').innerText=`${dateStr} ${timeStr}`;
    }
    setInterval(updateDateTime,1000);
    updateDateTime();

    // Splash Screen hide
    window.addEventListener('load',()=>{
      setTimeout(()=>{
        const splash=document.getElementById('splash');
        splash.style.opacity='0';
        setTimeout(()=>splash.style.display='none',1000);
      },1500);
    });

    // Upload preview
    document.getElementById('receiptUpload').addEventListener('change',function(){
      const files=this.files;
      document.getElementById('fileInfo').innerText=`‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ${files.length} ‡πÑ‡∏ü‡∏•‡πå`;
      const previewArea=document.getElementById('previewArea');
      previewArea.innerHTML='';
      for(let i=0;i<files.length;i++){
        const file=files[i];
        const reader=new FileReader();
        if(file.type.startsWith('image/')){
          reader.onload=function(e){
            const img=document.createElement('img');
            img.src=e.target.result;
            img.alt=file.name;
            img.className='w-full h-24 object-cover rounded shadow';
            previewArea.appendChild(img);
          };
          reader.readAsDataURL(file);
        }else{
          const p=document.createElement('p');
          p.textContent=`üìÑ ${file.name}`;
          p.className='text-xs text-gray-700 dark:text-gray-300';
          previewArea.appendChild(p);
        }
      }
    });

    // Tax calculation + Pie Chart
    function calculateTax(income,expense,deduction){
      const net=income-expense-deduction;
      return net<=150000?0:net*0.05;
    }

    document.getElementById('taxForm').addEventListener('submit',function(e){
      e.preventDefault();
      const income=parseFloat(document.getElementById('income').value);
      const expense=parseFloat(document.getElementById('expense').value);
      const deduction=parseFloat(document.getElementById('deduction').value);
      if(isNaN(income)||isNaN(expense)||isNaN(deduction)){alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç'); return;}
      const tax=calculateTax(income,expense,deduction);
      const ctx=document.getElementById('taxPieChart').getContext('2d');
      if(window.taxChart instanceof Chart) window.taxChart.destroy();
      const taxPercentage=(income-expense-deduction>150000)?100:0;
      window.taxChart=new Chart(ctx,{
        type:'pie',
        data:{labels:['‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ','‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ'],datasets:[{data:[taxPercentage,100-taxPercentage],backgroundColor:['#ef4444','#22c55e'],hoverOffset:4}]},
        options:{responsive:true,plugins:{legend:{position:'top'},title:{display:true,text:`‡∏†‡∏≤‡∏©‡∏µ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞: ${tax.toLocaleString('th-TH')} ‡∏ö‡∏≤‡∏ó`,font:{size:16}}}}
      });
    });
  </script>
</body>
</html>
